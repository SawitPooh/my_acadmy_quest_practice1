<section class="min-h-screen md:min-w-xl mx-auto">
    <div class="bg-white p-8 md:p-12 rounded shadow">
        <h1 class="text-amber-950 text-2xl font-bold mb-6 md:text-3xl">My Academy Quest</h1>

        <div class="flex justify-center">
            <%= image_tag "https://github.com/sawitpooh.png", alt: "Sawit Janpan", class: "w-20 h-20 md:w-30 md:h-30 rounded-full shadow-md mb-4" %>
        </div>

        <div class="flex justify-center">
            <p class="text-lg mb-4 md:text-xl">Sawit Janpan</p>
        </div>

        <div class="flex justify-center">
            <%= link_to "My Brag Document",  brag_path, class: "button text-blue-600 underline hover:text-blue-800 block mb-6" %>
        </div>
        
        <!-- Add Quest Form -->
        <%= form_with model: @quest, url: quests_path, method: :post, local: true, class: "flex flex-col md:flex-row md:items-start md:gap-4 mb-6" do |form| %>
        
        <!-- Field + error -->
        <div class="w-full md:flex-1 flex flex-col">
            <%= form.text_field :title,
                placeholder: "เพิ่มเควสต์ของฉัน",
                class: "border px-3 py-2 rounded w-full #{'border-red-500' if @quest.errors[:title].any?}" %>

            <% if @quest.errors[:title].any? %>
            <p class="text-red-500 text-sm mt-1"><%= @quest.errors[:title].first %></p>
            <% end %>
        </div>

        <!-- Button -->
        <%= form.submit "เพิ่ม", 
            class: "bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 w-full md:w-auto mt-2 md:mt-0", 
            data: { testid: "submit-quest" } %>
        <% end %>

        <!-- Quest List -->
        <div>
            <ul class="space-y-3">
            <% @quests.each do |quest| %>
                <li id="<%= dom_id(quest) %>" class="flex justify-between items-center bg-gray-100 px-4 py-3 rounded">
                    <!-- Left: Title -->
                    <div class="flex-1 min-w-0">
                        <label for="quest_<%= quest.id %>" 
                            class="text-base md:text-lg break-words whitespace-normal overflow-hidden <%= "line-through text-gray-500" if quest.status %>">
                        <%= quest.title %>
                        </label>
                    </div>

                    <!-- Right: Checkbox + Delete -->
                    <div class="flex items-center gap-3 shrink-0">
                        <%= form_with model: quest, url: toggle_status_quest_path(quest), method: :patch, data: { turbo_stream: true } do |form| %>
                        <%= form.check_box :status, {
                                checked: quest.status,
                                class: "w-5 h-5",
                                id: "quest_#{quest.id}",
                                onchange: "this.form.requestSubmit()",
                                data: { testid: "checkbox-quest-#{quest.id}" }
                            } %>
                        <% end %>

                        <%= button_to quest_path(quest),
                                    method: :delete,
                                    form: { data: { turbo_stream: true } },
                                    class: "group bg-transparent p-0 border-0" do %>
                        <%= image_tag "delete_icon.svg", alt: "Delete",
                                        class: "w-6 h-6 group-hover:opacity-60 transition-opacity duration-100" %>
                        <% end %>
                    </div>
                </li>
            <% end %>
            </ul>
        </div>
    </div>
</section>
